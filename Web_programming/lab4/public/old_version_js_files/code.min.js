"use strict";

var socket = io.connect('http://localhost:3000');
$('document').ready(function () {
  var participants;
  var paintings;
  var settings;
  $.ajax({
    type: 'get',
    url: 'http://localhost:3000/auc',
    success: function success(res) {
      console.log(res);
      participants = res.participants;
      paintings = res.paintings;
      settings = res.settings;
      var str;

      if (Math.floor(settings.duration % 60 / 10) == 0) {
        str = '0' + settings.duration % 60;
      } else {
        str = settings.duration % 60;
      }

      $('#time').text('0:00/' + Math.floor(settings.duration / 60) + ':' + str);
    }
  });
  $('#mainchat').draggable();
  $('#mainchat').resizable({
    alsoResize: "#chat",
    minWidth: 300,
    maxWidth: 300,
    minHeight: 200,
    maxHeigth: 500
  });
  $("#backMain").on('click', function () {
    window.location.href = '/main';
  });
  $('#send').on('click', function () {
    socket.emit('chat message', $('#m').val());
    $('#m').val("");
  });
  var username1 = localStorage.getItem('lab3.username');

  if (username1 === "") {
    $("#username").text("Guest");
    $("#auth").html("Log in");
    $("#auth").on("click", function () {
      window.location.href = '/';
    });
  } else {
    socket.emit('usernameAuc', username1);
    socket.on('identificationAuc', function (res) {
      if (res === 'error') {
        window.location.href = '/';
      } else {
        $("#username").text(username1);
        $("#auth").html("Log out");
        $("#auth").on("click", function () {
          localStorage.setItem('lab3.username', "");
          window.location.href = '/';
        });

        if (res === "admin") {
          admin();
        } else {
          if (res === "inAuc") {
            notAdmin();
          } else {
            $('body').append("<button id='backMain'>Back to menu</button>");
            $("#backMain").on('click', function () {
              window.location.href = '/main';
            });
          }
        }
      }
    });
  }

  socket.on('time', function (msg) {
    $("#time").text(msg);
    console.log(msg);
  });
  socket.on('betAns', function (res) {
    if (res != "notStarted") {
      if (res === 'error') {
        alert('Bet is improper');
      } else {
        $('#cur').text(res);
        $('<li>').text(res).hide().appendTo('#messages').slideDown(200);
      }
    }
  });
  socket.on('msg', function (msg) {
    $('<li>').text(msg).hide().appendTo('#messages').slideDown(200);
  });
  $("input").on('keypress', function (e) {
    if (e.which == 13) {
      socket.emit('chat message', $('#m').val());
      $('#m').val("");
    }
  });
});

function admin() {
  var start;
  var time = 0;
  var isStarted = false;
  var interval = 0;
  $('body').append("<button id='startButton'>Start auction</button>");
  $('body').append("<button id='backMain'>Back to menu</button>");
  $('#startButton').on('click', function () {
    console.log('start');
    socket.emit('timer', 'start');
    isend = false;
    isStarted = true;
    start = new Date();
    var m = 0;
    time = 0;
    return false;
  });
  $("#backMain").on('click', function () {
    window.location.href = '/main';
  });
}

function notAdmin() {
  var div = document.createElement("div");
  div.id = "betID";
  $('body').append(div);
  $('#betID').append('<input type="number" id="bet" placeholder="Bet"></input>');
  $('#betID').append('<button id="makeBet">Make bet</button>');
  $('#makeBet').on('click', function () {
    var value = $('#bet').val();
    socket.emit('bet', value);
  });
  socket.emit('minMax', 'get');
  socket.on('minMaxRes', function (res) {
    $("#bet").change(function () {
      var max = res.max;
      var min = res.min;

      if ($(this).val() > max) {
        $(this).val(max);
      } else if ($(this).val() < min) {
        $(this).val(min);
      }
    });
  });
  $('body').append("<button id='backMain'>Back to menu</button>");
  $("#backMain").on('click', function () {
    window.location.href = '/main';
  });
}

var createInput = function createInput(type, id) {
  var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
  var input = document.createElement("input");
  input.type = type;
  input.id = id;

  if (type === 'text') {
    input.placeholder = value;
  }

  if (type === "radio") {
    input.value = 'value';
  }

  return input;
};
"use strict";

//@flow
$('document').ready(function () {
  var socket = io.connect('http://localhost:3000');
  $("#part").on('click', function () {
    window.location.href = '/participants';
  });
  $("#img").on('click', function () {
    window.location.href = '/paintings';
  });
  $("#auc").on('click', function () {
    window.location.href = '/auction';
  });
  $("#set").on('click', function () {
    window.location.href = '/settings';
  });
  var username = localStorage.getItem('lab3.username');

  if (username === "") {
    $("#username").text("Guest");
    $("#auth").html("Log in");
    $("#auth").on("click", function () {
      window.location.href = '/';
    });
  } else {
    socket.emit('username', username);
    socket.on('identification', function (res) {
      if (res === 'error') {
        window.location.href = '/';
      }
    });
    $("#username").text(username);
    $("#auth").html("Log out");
    $("#auth").on("click", function () {
      localStorage.setItem('lab3.username', "");
      window.location.href = '/';
    });
  }
});
"use strict";

$('document').ready(function () {
  $('body').on('click', 'li[data-href]', function (e) {
    window.location = $(this).attr('data-href');
  });
  var socket = io.connect('http://localhost:3000');
  var username1 = localStorage.getItem('lab3.username');

  if (username1 === "") {
    $("#username").text("Guest");
    $("#auth").html("Log in");
    $("#auth").on("click", function () {
      window.location.href = '/';
    });
    notAdmin();
  } else {
    socket.emit('username', username1);
    socket.on('identification', function (res) {
      if (res === 'error') {
        window.location.href = '/';
      } else {
        if (res === "admin") {
          admin();
        } else {
          notAdmin();
        }

        $("#username").text(username1);
        $("#auth").html("Log out");
        $("#auth").on("click", function () {
          localStorage.setItem('lab3.username', "");
          window.location.href = '/';
        });
      }
    });
  }
});

function admin() {
  $("#buttons").append("<td><button id='addButton'>Add painting</button></td>");
  $("#buttons").append("<td><button id='backMain'>Back to menu</button></td>");
  $('#addButton').on('click', function () {
    showPopup();
  });
  $('#close_popup').on('click', function () {
    hidePopup();
  });
  $('#submit').on('click', function () {
    add();
    hidePopup();
  });
  $('#backMain').on('click', function () {
    window.location = "http://localhost:3000/main";
  });
}

function notAdmin() {
  $("#buttons").append("<td><button id='backMain'>Back to menu</button></td>");
  $('#backMain').on('click', function () {
    window.location = "http://localhost:3000/main";
  });
}

function add() {
  var painting = {
    name: 0,
    author: 0,
    date: ""
  };
  painting.name = $('#paint_name').val();
  painting.author = $('#paint_author').val();

  if (painting.name != "" && painting.author != "") {
    $.ajax({
      type: 'post',
      url: document.location.href,
      data: painting,
      success: function success(res) {
        var painting = res.painting;
        $('<li>', {
          "data-href": 'http://localhost:3000/paintings/' + painting.id,
          "data-id": painting.id,
          text: '«' + painting.name + '»' + ' ' + painting.author
        }).appendTo('ul');
      }
    });
    var fd = new FormData();
    var files = $('#file')[0].files[0];
    fd.append('file', files);
    file = $("#file").val();
    $.ajax({
      type: 'post',
      url: 'http://localhost:3000/paint',
      data: fd,
      processData: false,
      contentType: false,
      success: function success(res) {
        var painting = res.painting;
        console.log(res); //et objectURL = URL.createObjectURL(e);

        d = new Date();
        $("#image").removeAttr("src").attr("src", "http://localhost:3000/" + painting.id + '.jpg' + '?' + d.getTime());
      }
    });
  } else {
    alert("Input name and author of painting");
  }
}

function hidePopup() {
  $("#addPainting").css('display', 'none');
}

function showPopup() {
  $("#addPainting").css('display', 'block');
}
"use strict";

var _this = void 0;

$(document).ready(function () {
  $('#editButton').on('click', function () {
    $(_this).prop('disabled', true);
    $('#deleteButton').prop('disabled', true);
    $('#p_table').deleteRow(1);
    var row = $('#p_table').insertRow(1);
    row.insertCell().appendChild(createInput('text', 'p_name', 'Input name')).value = p.name;
    row.insertCell().appendChild(createInput('text', 'p_location', 'Input location')).value = p.location;
    row.insertCell().appendChild(createInput('text', 'p_in', 'Takes part?')).value = p.inAuc;
    row.insertCell().appendChild(createInput('number', 'p_x', 'x coord')).value = p.coords.x;
    row.insertCell().appendChild(createInput('number', 'p_y', 'y coord')).value = p.coords.y;
    var done = row.insertCell();
    done.innerText = '✓';
    done.style.cursor = 'pointer';
    done.style = "border-radius: 50px;cursor:pointer;font-weight:bold;";

    done.onclick = function () {
      p.name = $('#p_name').val();
      p.location = $('#p_location').val();
      p.inAuc = $('#p_in').val();

      if (p.name != "" && p.location != "" && (p.inAuc === "Yes" || p.inAuc === "No")) {
        p.coords.x = $('#p_x').val();
        p.coords.y = $('#p_coords.x').val();
        send(b);
        $(this).prop('disabled', true);
        $('#deleteButton').prop('disabled', true);
      } else {
        alert("Input correct data please!");
      }
    };
  });
  $("#deleteButton").on('click', function () {
    var id = p.id;
    alert("Книга была удалена");
    window.location.href = '/participants';
    $.ajax({
      type: 'delete',
      url: '/participants/' + id
    });
  });

  var send = function send(participant) {
    $.ajax({
      type: 'put',
      url: window.location.href,
      data: participant,
      success: function success(res) {
        var participant = res.participant;

        if (participant) {
          $('#p_table').deleteRow(1);
          var row = $('#p_table').insertRow(1);
          row.insertCell().innerText = participant.name;
          row.insertCell().innerText = participant.location;
          row.insertCell().innerText = participant.inAuc;
          row.insertCell().innerText = 'x: ' + participant.coords.x + ' ' + 'y: ' + participant.coords.y;
        } else {
          alert(res.message ? res.message : "Неизвестная ошибка на стороне сервера");
        }
      }
    });
  };

  var createInput = function createInput(type, id) {
    var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var input = document.createElement("input");
    input.type = type;
    input.id = id;

    if (type === 'text') {
      input.placeholder = value;
    }

    if (type === "radio") {
      input.value = 'value';
    }

    return input;
  };
});
"use strict";

$('document').ready(function () {
  $('body').on('click', 'li[data-href]', function (e) {
    window.location = $(this).attr('data-href');
  });
  var socket = io.connect('http://localhost:3000');
  var username1 = localStorage.getItem('lab3.username');

  if (username1 === "") {
    $("#username").text("Guest");
    $("#auth").html("Log in");
    $("#auth").on("click", function () {
      window.location.href = '/';
    });
    notAdmin();
  } else {
    socket.emit('username', username1);
    socket.on('identification', function (res) {
      if (res === 'error') {
        window.location.href = '/';
      } else {
        if (res === "admin") {
          admin();
        } else {
          notAdmin();
        }

        $("#username").text(username1);
        $("#auth").html("Log out");
        $("#auth").on("click", function () {
          localStorage.setItem('lab3.username', "");
          window.location.href = '/';
        });
      }
    });
  }
});

function admin() {
  $("#buttons").append("<td><button id='addButton'>Add participant</button></td>");
  $("#buttons").append("<td><button id='backMain'>Back to menu</button></td>");
  $('#addButton').on('click', function () {
    showPopup();
  });
  $('#close_popup').on('click', function () {
    hidePopup();
  });
  $('#submit').on('click', function () {
    add();
    hidePopup();
  });
  $('#backMain').on('click', function () {
    window.location = "http://localhost:3000/main";
  });
}

function notAdmin() {
  $("#buttons").append("<td><button id='backMain'>Back to menu</button></td>");
  $('#backMain').on('click', function () {
    window.location = "http://localhost:3000/main";
  });
}

ymaps.ready().done(function (ym) {
  var myMap = new ym.Map('YMapsID', {
    center: [55.751574, 37.573856],
    zoom: 10
  }, {
    searchControlProvider: 'yandex#search'
  });
  $.getJSON('data.json', function (json) {
    /** Сохраним ссылку на геообъекты на случай, если понадобится какая-либо постобработка.
    * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/GeoQueryResult.xml
    */
    var geoObjects = ym.geoQuery(json).addToMap(myMap).applyBoundsToMap(myMap, {
      checkZoomRange: true
    });
  });
});

function add() {
  var participant = {
    name: 0,
    location: 0
  };
  participant.name = $('#p_name').val();
  participant.location = $('#p_location').val();

  if (participant.name != "" && participant.location != "") {
    $.ajax({
      type: 'post',
      url: '/participants',
      data: participant,
      success: function success(res) {
        $('<li>', {
          "data-href": 'https://localhost:3000/participants/' + res.participant.id,
          "data-id": res.participant.id,
          text: res.participant.name
        }).appendTo('ul');
      }
    });
  } else {
    alert("Input name and location of participant");
  }
}

function hidePopup() {
  $("#YMapsID").css('display', 'block');
  $("#addPainting").css('display', 'none');
}

function showPopup() {
  $("#YMapsID").css('display', 'none');
  $("#addPainting").css('display', 'block');
}